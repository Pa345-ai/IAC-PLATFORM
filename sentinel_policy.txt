# policies/sentinel.hcl
# Sentinel Policy Configuration for Bank-Grade Infrastructure

# Policy Sets
policy "encryption-at-rest" {
  source            = "./policies/rego/encryption_enforcement.rego"
  enforcement_level = "hard-mandatory"
}

policy "data-residency" {
  source            = "./policies/rego/data_residency.rego"
  enforcement_level = "hard-mandatory"
}

policy "iam-boundaries" {
  source            = "./policies/rego/iam_boundary_check.rego"
  enforcement_level = "hard-mandatory"
}

policy "terraform-plan-review" {
  source            = "./policies/rego/terraform-plan-review.rego"
  enforcement_level = "advisory"
}

# Policy Modules
module "aws_compliance" {
  source = "app.terraform.io/bank-org/aws-compliance/sentinel"
}

module "pci_dss" {
  source = "app.terraform.io/bank-org/pci-dss/sentinel"
}

module "nist_800_53" {
  source = "app.terraform.io/bank-org/nist-800-53/sentinel"
}

# Global Configuration
globals = {
  approved_regions = [
    "us-east-1",
    "us-east-2",
    "us-west-1",
    "us-west-2"
  ]
  
  required_tags = [
    "Environment",
    "ManagedBy",
    "CostCenter",
    "Compliance"
  ]
  
  minimum_kms_key_rotation_days = 365
  maximum_rds_backup_retention  = 35
  minimum_s3_lifecycle_days     = 90
}

# Test Configuration
test "encryption-at-rest" {
  rules = {
    main = true
  }
}

test "data-residency" {
  rules = {
    main = true
  }
}

test "iam-boundaries" {
  rules = {
    main = true
  }
}