# modules/security/kms/variables.tf

variable "environment" {
  description = "Environment name"
  type        = string
}

variable "key_name" {
  description = "Name for the KMS key"
  type        = string
}

variable "key_description" {
  description = "Description for the KMS key"
  type        = string
  default     = ""
}

variable "key_purpose" {
  description = "Purpose of the KMS key (for tagging)"
  type        = string
  default     = "Encryption"
}

variable "deletion_window" {
  description = "Duration in days after which the key is deleted after destruction (7-30)"
  type        = number
  default     = 30
  
  validation {
    condition     = var.deletion_window >= 7 && var.deletion_window <= 30
    error_message = "Deletion window must be between 7 and 30 days."
  }
}

variable "enable_key_rotation" {
  description = "Enable automatic key rotation (required for PCI-DSS)"
  type        = bool
  default     = true
}

variable "multi_region" {
  description = "Enable multi-region replication for the key"
  type        = bool
  default     = false
}

variable "key_spec" {
  description = "Key specification (SYMMETRIC_DEFAULT, RSA_2048, etc.)"
  type        = string
  default     = "SYMMETRIC_DEFAULT"
  
  validation {
    condition = contains([
      "SYMMETRIC_DEFAULT",
      "RSA_2048",
      "RSA_3072",
      "RSA_4096",
      "ECC_NIST_P256",
      "ECC_NIST_P384",
      "ECC_NIST_P521"
    ], var.key_spec)
    error_message = "Invalid key specification."
  }
}

variable "key_usage" {
  description = "Intended use of the key (ENCRYPT_DECRYPT or SIGN_VERIFY)"
  type        = string
  default     = "ENCRYPT_DECRYPT"
  
  validation {
    condition     = contains(["ENCRYPT_DECRYPT", "SIGN_VERIFY"], var.key_usage)
    error_message = "Key usage must be ENCRYPT_DECRYPT or SIGN_VERIFY."
  }
}

variable "key_administrators" {
  description = "List of IAM principal ARNs that can administer the key"
  type        = list(string)
  default     = []
}

variable "key_users" {
  description = "List of IAM principal ARNs that can use the key"
  type        = list(string)
  default     = []
}

variable "service_principals" {
  description = "List of AWS service principals that can use the key"
  type        = list(string)
  default     = []
}

variable "service_grants" {
  description = "Map of service grants to create"
  type = map(object({
    grantee_principal          = string
    operations                 = list(string)
    encryption_context_equals  = optional(map(string))
    encryption_context_subset  = optional(map(string))
  }))
  default = {}
}

variable "enable_monitoring" {
  description = "Enable CloudWatch monitoring and alarms"
  type        = bool
  default     = true
}

variable "alarm_sns_topic_arns" {
  description = "List of SNS topic ARNs for alarm notifications"
  type        = list(string)
  default     = []
}

variable "tags" {
  description = "Additional tags for the KMS key"
  type        = map(string)
  default     = {}
}